---
import Layout from '../../../layouts/Layout.astro';
import Navbar from '../../../components/Navbar.astro';
import Footer from '../../../components/Footer.astro';
import { discoverManifests, getAllPages, getCategories, formatCategoryTitle } from '../../../lib/content-loader';

export function getStaticPaths() {
  const manifests = discoverManifests();
  return manifests.map(({ manifest }) => ({
    params: { repoSlug: manifest.repo.slug },
    props: { manifest },
  }));
}

const { manifest } = Astro.props;
const allPages = getAllPages();
const repoPages = allPages.filter(p => p.repoSlug === manifest.repo.slug);

// Collection icons (SVG paths)
const collectionIcons: Record<string, string> = {
  frameworks: 'M5.005 11.19V12l6.998 4.042L19 12v-.81M5 16.15v.81L11.997 21l6.998-4.042v-.81M12.003 3 5.005 7.042l6.998 4.042L19 7.042 12.003 3Z',
  'learning-plans': 'M12 6.03v13m0-13c-2.819-.831-4.715-1.076-8.029-1.023A.99.99 0 0 0 3 6v11c0 .563.466 1.014 1.03 1.007 3.122-.043 5.018.212 7.97 1.023m0-13c2.819-.831 4.715-1.076 8.029-1.023A.99.99 0 0 1 21 6v11c0 .563-.466 1.014-1.03 1.007-3.122-.043-5.018.212-7.97 1.023',
};
---

<Layout>
  <Navbar />

  <div class="toolkit-content-page">
    <!-- Hero -->
    <section class="relative overflow-hidden bg-white dark:bg-gray-900">
      <div class="absolute inset-0 opacity-[0.025] dark:opacity-[0.04] pointer-events-none">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
          <pattern id="repo-lattice" x="0" y="0" width="56" height="56" patternUnits="userSpaceOnUse">
            <path d="M28 0 L56 28 L28 56 L0 28Z" fill="none" stroke="#6B7280" stroke-width="0.6"/>
          </pattern>
          <rect width="100%" height="100%" fill="url(#repo-lattice)" />
        </svg>
      </div>

      <div class="relative pt-28 lg:pt-36 pb-16 lg:pb-24 px-4 mx-auto max-w-screen-xl">
        <!-- Breadcrumbs -->
        <nav class="reveal mb-8" aria-label="Breadcrumb">
          <ol class="flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400">
            <li><a href="/toolkit/" class="hover:text-gray-900 dark:hover:text-white transition-colors">Toolkit</a></li>
            <li class="flex items-center">
              <svg class="w-3 h-3 mx-1.5 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              <span class="text-gray-900 dark:text-white font-medium">{manifest.repo.title}</span>
            </li>
          </ol>
        </nav>

        <div class="max-w-screen-md">
          <h1 class="reveal rd1 text-4xl md:text-5xl xl:text-6xl font-semibold leading-tight tracking-tight text-gray-900 dark:text-white mb-4">
            {manifest.repo.title}
          </h1>
          <p class="reveal rd2 text-lg text-gray-500 dark:text-gray-400 leading-relaxed mb-6 max-w-xl">
            {manifest.repo.description}
          </p>

          <!-- Stats -->
          <div class="reveal rd2 flex items-center gap-6 mb-8">
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
              <svg class="w-4 h-4 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/>
              </svg>
              <span><strong class="font-semibold text-gray-900 dark:text-white">{repoPages.length}</strong> resources</span>
            </div>
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
              <svg class="w-4 h-4 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"/>
              </svg>
              <span><strong class="font-semibold text-gray-900 dark:text-white">{manifest.collections.length}</strong> collections</span>
            </div>
          </div>

          <div class="reveal rd3 flex flex-col sm:flex-row gap-3">
            <a href={manifest.repo.github_url} target="_blank" rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
              </svg>
              View on GitHub
            </a>
            <a href="https://claude.ai/code" target="_blank" rel="noopener noreferrer"
              class="inline-flex items-center px-5 py-2.5 text-sm font-medium text-white bg-brand-700 hover:bg-brand-800 rounded-lg transition-colors focus:ring-4 focus:ring-brand-200 dark:focus:ring-brand-900">
              Use with Claude Code
              <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Collections -->
    <section class="bg-gray-50 dark:bg-gray-800/50">
      <div class="py-16 lg:py-24 px-4 mx-auto max-w-screen-xl">
        <h2 class="reveal text-2xl font-semibold text-gray-900 dark:text-white mb-8">Collections</h2>
        <div class="grid gap-6 md:grid-cols-2">
          {manifest.collections.map((collection: any, idx: number) => {
            const collectionPages = repoPages.filter(p => p.collectionId === collection.id);
            const categories = getCategories(repoPages, manifest.repo.slug, collection.id);
            const iconPath = collectionIcons[collection.id] || collectionIcons.frameworks;
            const delay = idx === 0 ? 'rd1' : 'rd2';

            return (
              <a href={`/toolkit/${manifest.repo.slug}/${collection.id}/`}
                class={`reveal ${delay} group p-7 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900/50 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200`}>
                <div class="flex items-start gap-4 mb-4">
                  <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-700/50 group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors flex-shrink-0">
                    <svg class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d={iconPath} />
                    </svg>
                  </div>
                  <div>
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-1">{collection.title}</h2>
                    <span class="text-sm text-gray-400 dark:text-gray-500">{collectionPages.length} items</span>
                  </div>
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed mb-5">{collection.description}</p>
                {categories.length > 0 && (
                  <div class="flex flex-wrap gap-1.5 mb-4">
                    {categories.map(cat => (
                      <span class="px-2 py-0.5 text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50 rounded">
                        {formatCategoryTitle(cat)}
                      </span>
                    ))}
                  </div>
                )}
                <span class="inline-flex items-center gap-1.5 text-sm font-medium text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors">
                  Browse collection
                  <svg class="w-3.5 h-3.5 transition-transform group-hover:translate-x-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                  </svg>
                </span>
              </a>
            );
          })}
        </div>
      </div>
    </section>

    <Footer />
  </div>
</Layout>

<style>
  .toolkit-content-page {
    font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
  }

  .reveal {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
  .rd1 { transition-delay: 0.1s; }
  .rd2 { transition-delay: 0.2s; }
  .rd3 { transition-delay: 0.3s; }
</style>

<script is:inline>
  (function() {
    var observer = new IntersectionObserver(
      function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -32px 0px' }
    );
    document.querySelectorAll('.toolkit-content-page .reveal').forEach(function(el) {
      observer.observe(el);
    });
  })();
</script>
