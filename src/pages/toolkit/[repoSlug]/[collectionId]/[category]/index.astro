---
import Layout from '../../../../../layouts/Layout.astro';
import Navbar from '../../../../../components/Navbar.astro';
import Footer from '../../../../../components/Footer.astro';
import { discoverManifests, getAllPages, getCategories, formatCategoryTitle } from '../../../../../lib/content-loader';

export function getStaticPaths() {
  const manifests = discoverManifests();
  const allPages = getAllPages();
  const paths: any[] = [];

  for (const { manifest } of manifests) {
    for (const collection of manifest.collections) {
      const categories = getCategories(allPages, manifest.repo.slug, collection.id);
      for (const category of categories) {
        paths.push({
          params: {
            repoSlug: manifest.repo.slug,
            collectionId: collection.id,
            category,
          },
          props: { manifest, collection, category },
        });
      }
    }
  }
  return paths;
}

const { manifest, collection, category } = Astro.props;
const allPages = getAllPages();
const categoryPages = allPages
  .filter(p => p.repoSlug === manifest.repo.slug && p.collectionId === collection.id && p.category === category)
  .sort((a, b) => a.title.localeCompare(b.title));

const categoryTitle = formatCategoryTitle(category);
---

<Layout>
  <Navbar />

  <div class="toolkit-content-page">
    <div class="pt-20 lg:pt-24 pb-16 lg:pb-24 bg-white dark:bg-gray-900">
      <div class="px-4 mx-auto max-w-screen-xl">

        <!-- Breadcrumbs -->
        <nav class="mb-8" aria-label="Breadcrumb">
          <ol class="flex flex-wrap items-center gap-1 text-sm text-gray-500 dark:text-gray-400">
            <li><a href="/toolkit/" class="hover:text-gray-900 dark:hover:text-white transition-colors">Toolkit</a></li>
            <li class="flex items-center">
              <svg class="w-3 h-3 mx-1.5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              <a href={`/toolkit/${manifest.repo.slug}/`} class="hover:text-gray-900 dark:hover:text-white transition-colors">{manifest.repo.title}</a>
            </li>
            <li class="flex items-center">
              <svg class="w-3 h-3 mx-1.5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              <a href={`/toolkit/${manifest.repo.slug}/${collection.id}/`} class="hover:text-gray-900 dark:hover:text-white transition-colors">{collection.title}</a>
            </li>
            <li class="flex items-center">
              <svg class="w-3 h-3 mx-1.5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              <span class="text-gray-900 dark:text-white font-medium">{categoryTitle}</span>
            </li>
          </ol>
        </nav>

        <div class="mb-10">
          <h1 class="text-3xl md:text-4xl font-semibold text-gray-900 dark:text-white mb-3">{categoryTitle}</h1>
          <p class="text-lg text-gray-500 dark:text-gray-400">
            {categoryPages.length} {categoryPages.length === 1 ? 'framework' : 'frameworks'} in {categoryTitle.toLowerCase()}
          </p>
        </div>

        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {categoryPages.map(page => (
            <a href={page.url}
              class="group p-5 rounded-xl border border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-800/30 hover:bg-gray-50 dark:hover:bg-gray-800/60 hover:border-gray-200 dark:hover:border-gray-700 hover:shadow-sm transition-all">
              <h3 class="text-base font-semibold text-gray-900 dark:text-white group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors mb-2">{page.title}</h3>
              {page.frontmatter.one_liner && (
                <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed mb-3 line-clamp-2">{page.frontmatter.one_liner}</p>
              )}
              {page.frontmatter.source_guest && (
                <p class="text-xs text-gray-400 dark:text-gray-500">
                  From: {page.frontmatter.source_guest}
                </p>
              )}
            </a>
          ))}
        </div>
      </div>
    </div>

    <Footer />
  </div>
</Layout>

<style>
  .toolkit-content-page {
    font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
  }
</style>
